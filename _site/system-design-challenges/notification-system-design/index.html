

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/engineering-ascend/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/engineering-ascend/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  
.site-nav ul li a {
  background-image: none;
}

  </style>

  

  
    <script src="/engineering-ascend/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/engineering-ascend/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Notification System Design - System Design Challenge | Engineering Ascend</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Notification System Design - System Design Challenge" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Comprehensive solution for notification system design system design challenge" />
<meta property="og:description" content="Comprehensive solution for notification system design system design challenge" />
<link rel="canonical" href="http://0.0.0.0:4018/engineering-ascend/system-design-challenges/notification-system-design/" />
<meta property="og:url" content="http://0.0.0.0:4018/engineering-ascend/system-design-challenges/notification-system-design/" />
<meta property="og:site_name" content="Engineering Ascend" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Notification System Design - System Design Challenge" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Comprehensive solution for notification system design system design challenge","headline":"Notification System Design - System Design Challenge","url":"http://0.0.0.0:4018/engineering-ascend/system-design-challenges/notification-system-design/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Back to Top Button Script -->
<script src="/engineering-ascend/assets/js/back-to-top.js"></script>

<!-- Footer Replacer Script -->
<script src="/engineering-ascend/assets/js/footer-replacer.js"></script>


</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/engineering-ascend/" class="site-title lh-tight">
  Engineering Ascend

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><a href="/engineering-ascend/back-of-envelope-estimation/" class="nav-list-link">Back-of-the-Envelope Cost Estimation</a></li><li class="nav-list-item"><a href="/engineering-ascend/building-blocks/" class="nav-list-link">Building Blocks</a></li><li class="nav-list-item"><a href="/engineering-ascend/" class="nav-list-link">Engineering Ascend</a></li><li class="nav-list-item"><a href="/engineering-ascend/quantitative-metrics/" class="nav-list-link">Quantitative Metrics for System Design</a></li><li class="nav-list-item"><a href="/engineering-ascend/cheatsheet/" class="nav-list-link">System Design - Quick Reference</a></li><li class="nav-list-item"><a href="/engineering-ascend/system-design-challenges/" class="nav-list-link">System Design Challenges</a></li><li class="nav-list-item"><a href="/engineering-ascend/decision-framework/" class="nav-list-link">System Design Decision Framework</a></li><li class="nav-list-item"><a href="/engineering-ascend/context/" class="nav-list-link">System Design Fundamentals - Comprehensive Guide</a></li><li class="nav-list-item"><a href="/engineering-ascend/trade-off-analysis/" class="nav-list-link">Trade-off Analysis in System Design</a></li></ul>

  
</nav>


  
  
    <footer class="site-footer">
      <!-- Custom Footer with Sponsorship -->
<footer class="custom-footer">
  <div class="footer-content">
    <div class="sponsorship-section">
      <h3 class="sponsorship-title">Support Engineering Ascend</h3>
      <p class="sponsorship-description">
        If you find this documentation helpful for your system design interviews and learning, 
        consider supporting the project to keep it free and updated.
      </p>
      <div class="sponsorship-buttons">
        <a href="https://ko-fi.com/engineeringascend" target="_blank" class="ko-fi-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M23.881 8.948c-.773-4.085-4.201-6.788-8.285-6.788-4.085 0-7.512 2.703-8.285 6.788C7.548 11.832 0 16.956 0 23.469c0 .767.629 1.346 1.396 1.346H22.602c.767 0 1.396-.58 1.396-1.346 0-6.513-7.548-11.637-16.119-14.521zM12 4.935c2.953 0 5.348 2.395 5.348 5.348S14.953 15.63 12 15.63s-5.348-2.395-5.348-5.348S9.047 4.935 12 4.935z"/>
          </svg>
          Buy Me a Coffee
        </a>
      </div>
    </div>
    <div class="footer-info">
      <p>&copy; 2024 Engineering Ascend. Empowering engineers to master system design.</p>
    </div>
  </div>
</footer>

    </footer>
  
</div>

  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Engineering Ascend" aria-label="Search Engineering Ascend" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
</div>

    <div class="main-content-wrap">
      <nav aria-label="Breadcrumb" class="breadcrumb-nav">
  <ol class="breadcrumb-nav-list">
  
    <li class="breadcrumb-nav-list-item"><a href="">System Design Challenges</a></li>
    <li class="breadcrumb-nav-list-item"><a href="">Notification System Design</a></li>
  <li class="breadcrumb-nav-list-item"><span>Notification System Design - System Design Challenge</span></li>
  </ol>
</nav>
      <div id="main-content" class="main-content">
        <main>
          
            <h1 id="design-a-notification-system---system-design-challenge">
  
  
    <a href="#design-a-notification-system---system-design-challenge" class="anchor-heading" aria-labelledby="design-a-notification-system---system-design-challenge"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Design a Notification System - System Design Challenge
  
  
</h1>
    

<p><em>Comprehensive solution for designing a scalable push notification service, covering delivery mechanisms, user preferences, and global scale.</em></p>
<h2 id="-challenge-overview">
  
  
    <a href="#-challenge-overview" class="anchor-heading" aria-labelledby="-challenge-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🎯 <strong>Challenge Overview</strong>
  
  
</h2>
    

<p>Design a scalable push notification system that can deliver millions of notifications per second across multiple platforms (mobile, web, email) with high reliability and personalization.</p>
<h3 id="key-requirements">
  
  
    <a href="#key-requirements" class="anchor-heading" aria-labelledby="key-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Key Requirements</strong>
  
  
</h3>
    
<ul>
  <li><strong>Scale</strong>: 10M+ notifications/second across multiple platforms</li>
  <li><strong>Reliability</strong>: 99.9% delivery success rate</li>
  <li><strong>Latency</strong>: &lt;5 seconds for critical notifications</li>
  <li><strong>Personalization</strong>: User preference management</li>
  <li><strong>Multi-platform</strong>: iOS, Android, Web, Email support</li>
</ul>
<h2 id="️-reshaded-framework-solution">
  
  
    <a href="#️-reshaded-framework-solution" class="anchor-heading" aria-labelledby="️-reshaded-framework-solution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 🏗️ <strong>RESHADED Framework Solution</strong>
  
  
</h2>
    
<h3 id="step-1-requirements--constraints">
  
  
    <a href="#step-1-requirements--constraints" class="anchor-heading" aria-labelledby="step-1-requirements--constraints"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 1: Requirements &amp; Constraints</strong>
  
  
</h3>
    
<h4 id="functional-requirements">
  
  
    <a href="#functional-requirements" class="anchor-heading" aria-labelledby="functional-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Functional Requirements</strong>
  
  
</h4>
    
<ul>
  <li><strong>Notification Delivery</strong>: Send to multiple platforms</li>
  <li><strong>User Preferences</strong>: Manage notification settings</li>
  <li><strong>Templates</strong>: Reusable notification templates</li>
  <li><strong>Scheduling</strong>: Delayed and recurring notifications</li>
  <li><strong>Analytics</strong>: Delivery tracking and engagement metrics</li>
</ul>
<h4 id="non-functional-requirements">
  
  
    <a href="#non-functional-requirements" class="anchor-heading" aria-labelledby="non-functional-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Non-Functional Requirements</strong>
  
  
</h4>
    
<ul>
  <li><strong>Scalability</strong>: Handle millions of notifications per second</li>
  <li><strong>Reliability</strong>: High delivery success rate</li>
  <li><strong>Performance</strong>: Low latency delivery</li>
  <li><strong>Availability</strong>: 99.99% uptime</li>
  <li><strong>Personalization</strong>: User-specific content and timing</li>
</ul>
<h4 id="constraints">
  
  
    <a href="#constraints" class="anchor-heading" aria-labelledby="constraints"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Constraints</strong>
  
  
</h4>
    
<ul>
  <li><strong>Platform Limitations</strong>: Different APIs and rate limits</li>
  <li><strong>User Privacy</strong>: Respect user preferences and regulations</li>
  <li><strong>Network Reliability</strong>: Handle mobile network issues</li>
  <li><strong>Cost</strong>: Minimize delivery costs across platforms</li>
</ul>
<h3 id="step-2-estimation--scale">
  
  
    <a href="#step-2-estimation--scale" class="anchor-heading" aria-labelledby="step-2-estimation--scale"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 2: Estimation &amp; Scale</strong>
  
  
</h3>
    
<h4 id="capacity-planning">
  
  
    <a href="#capacity-planning" class="anchor-heading" aria-labelledby="capacity-planning"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Capacity Planning</strong>
  
  
</h4>
    
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Daily Active Users: 100M
Notifications per User: 10/day average
Total Daily Notifications: 100M × 10 = 1B/day
Peak Hour Notifications: 1B × 0.15 = 150M/hour
Peak Minute Notifications: 150M ÷ 60 = 2.5M/minute
Peak Second Notifications: 2.5M ÷ 60 = 42K/second

Platform Distribution:
- iOS: 40% = 16.8K/second
- Android: 35% = 14.7K/second
- Web: 15% = 6.3K/second
- Email: 10% = 4.2K/second

Storage Requirements:
- User Preferences: 100M × 2KB = 200GB
- Notification History: 1B × 1KB = 1TB/day
- Templates: 10K × 10KB = 100MB
</code></pre></div></div>
<h4 id="peak-load-estimation">
  
  
    <a href="#peak-load-estimation" class="anchor-heading" aria-labelledby="peak-load-estimation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Peak Load Estimation</strong>
  
  
</h4>
    
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Peak Factor: 5x normal load
Peak Notifications: 210K/second
Peak Storage: 5TB/day

Geographic Distribution:
- North America: 40%
- Europe: 30%
- Asia: 20%
- Others: 10%
</code></pre></div></div>
<h3 id="step-3-system-interface-design">
  
  
    <a href="#step-3-system-interface-design" class="anchor-heading" aria-labelledby="step-3-system-interface-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 3: System Interface Design</strong>
  
  
</h3>
    
<h4 id="api-design">
  
  
    <a href="#api-design" class="anchor-heading" aria-labelledby="api-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>API Design</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Core Operations
</span><span class="nf">send_notification</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">template_id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">notification_id</span>
<span class="nf">send_bulk_notifications</span><span class="p">(</span><span class="n">user_ids</span><span class="p">[],</span> <span class="n">template_id</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">notification_id</span><span class="p">]</span>
<span class="nf">schedule_notification</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">template_id</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">schedule_time</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">notification_id</span>

<span class="c1"># User Preferences
</span><span class="nf">update_preferences</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">preferences</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">success</span>
<span class="nf">get_preferences</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">preferences</span>
<span class="nf">subscribe_topic</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">topic</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">success</span>
<span class="nf">unsubscribe_topic</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">topic</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">success</span>

<span class="c1"># Analytics
</span><span class="nf">get_delivery_status</span><span class="p">(</span><span class="n">notification_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">status</span>
<span class="nf">get_user_engagement</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">metrics</span>
<span class="nf">get_template_performance</span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">analytics</span>
</code></pre></div></div>
<h4 id="data-models">
  
  
    <a href="#data-models" class="anchor-heading" aria-labelledby="data-models"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Data Models</strong>
  
  
</h4>
    
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"notification"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"notif_123456"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user_789"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"template_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"welcome_email"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"platform"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ios"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Welcome to our app!"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"body"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Thank you for joining us."</span><span class="p">,</span><span class="w">
    </span><span class="nl">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"deep_link"</span><span class="p">:</span><span class="w"> </span><span class="s2">"app://welcome"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"image_url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://example.com/welcome.jpg"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"scheduled_at"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-01T10:00:00Z"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"pending"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"user_preferences"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user_789"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"platforms"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"ios"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nl">"enabled"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nl">"quiet_hours"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"22:00"</span><span class="p">,</span><span class="w">
          </span><span class="nl">"end"</span><span class="p">:</span><span class="w"> </span><span class="s2">"08:00"</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nl">"categories"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nl">"marketing"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
          </span><span class="nl">"transactional"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
          </span><span class="nl">"promotional"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nl">"topics"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"news"</span><span class="p">,</span><span class="w"> </span><span class="s2">"updates"</span><span class="p">,</span><span class="w"> </span><span class="s2">"offers"</span><span class="p">]</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<h3 id="step-4-high-level-architecture">
  
  
    <a href="#step-4-high-level-architecture" class="anchor-heading" aria-labelledby="step-4-high-level-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 4: High-Level Architecture</strong>
  
  
</h3>
    

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌─────────────────────────────────────────────────────────┐
│                Client Applications                      │
├─────────────────────────────────────────────────────────┤
│                    Load Balancer                        │
├─────────────────────────────────────────────────────────┤
│              API Gateway / Notification Service          │
├─────────────────────────────────────────────────────────┤
│              Notification Processing Pipeline            │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │   iOS       │  │  Android    │  │    Web      │     │
│  │  Service    │  │  Service    │  │   Service   │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
├─────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │   Email     │  │  SMS        │  │  In-App     │     │
│  │  Service    │  │  Service    │  │  Service    │     │
│  └─────────────┘  └─────────────┘  └─────────────┘     │
├─────────────────────────────────────────────────────────┤
│              User Preferences &amp; Analytics               │
├─────────────────────────────────────────────────────────┤
│              Storage Layer (Notifications, Preferences) │
└─────────────────────────────────────────────────────────┘
</code></pre></div></div>
<h3 id="step-5-application-layer-design">
  
  
    <a href="#step-5-application-layer-design" class="anchor-heading" aria-labelledby="step-5-application-layer-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 5: Application Layer Design</strong>
  
  
</h3>
    
<h4 id="notification-processing-pipeline">
  
  
    <a href="#notification-processing-pipeline" class="anchor-heading" aria-labelledby="notification-processing-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Notification Processing Pipeline</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NotificationPipeline</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">preference_checker</span> <span class="o">=</span> <span class="nc">UserPreferenceChecker</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">template_engine</span> <span class="o">=</span> <span class="nc">TemplateEngine</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">platform_router</span> <span class="o">=</span> <span class="nc">PlatformRouter</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">analytics_tracker</span> <span class="o">=</span> <span class="nc">AnalyticsTracker</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">process_notification</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">notification_request</span><span class="p">):</span>
        <span class="c1"># 1. Validate request
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">_validate_request</span><span class="p">(</span><span class="n">notification_request</span><span class="p">)</span>
        
        <span class="c1"># 2. Check user preferences
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">preference_checker</span><span class="p">.</span><span class="nf">should_send</span><span class="p">(</span><span class="n">notification_request</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{</span><span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">skipped</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">reason</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">user_preference</span><span class="sh">"</span><span class="p">}</span>
        
        <span class="c1"># 3. Render template
</span>        <span class="n">rendered_content</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">template_engine</span><span class="p">.</span><span class="nf">render</span><span class="p">(</span>
            <span class="n">notification_request</span><span class="p">.</span><span class="n">template_id</span><span class="p">,</span>
            <span class="n">notification_request</span><span class="p">.</span><span class="n">data</span>
        <span class="p">)</span>
        
        <span class="c1"># 4. Route to appropriate platform
</span>        <span class="n">platform_service</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">platform_router</span><span class="p">.</span><span class="nf">get_service</span><span class="p">(</span>
            <span class="n">notification_request</span><span class="p">.</span><span class="n">platform</span>
        <span class="p">)</span>
        
        <span class="c1"># 5. Send notification
</span>        <span class="n">delivery_result</span> <span class="o">=</span> <span class="n">platform_service</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">rendered_content</span><span class="p">)</span>
        
        <span class="c1"># 6. Track analytics
</span>        <span class="n">self</span><span class="p">.</span><span class="n">analytics_tracker</span><span class="p">.</span><span class="nf">track_delivery</span><span class="p">(</span><span class="n">delivery_result</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">delivery_result</span>
</code></pre></div></div>
<h4 id="platform-specific-services">
  
  
    <a href="#platform-specific-services" class="anchor-heading" aria-labelledby="platform-specific-services"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Platform-Specific Services</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">IOSNotificationService</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">apns_client</span> <span class="o">=</span> <span class="nc">APNSClient</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="nc">RateLimiter</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">notification</span><span class="p">):</span>
        <span class="c1"># Check rate limits
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">rate_limiter</span><span class="p">.</span><span class="nf">allow_request</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nc">RateLimitExceeded</span><span class="p">()</span>
        
        <span class="c1"># Format for APNS
</span>        <span class="n">apns_payload</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_format_for_apns</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
        
        <span class="c1"># Send via APNS
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">apns_client</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">apns_payload</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">delivered</span><span class="sh">"</span> <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">success</span> <span class="k">else</span> <span class="sh">"</span><span class="s">failed</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">message_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">response</span><span class="p">.</span><span class="n">message_id</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="n">response</span><span class="p">.</span><span class="n">error</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">_format_for_apns</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">notification</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">aps</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">alert</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">title</span><span class="sh">"</span><span class="p">:</span> <span class="n">notification</span><span class="p">.</span><span class="n">title</span><span class="p">,</span>
                    <span class="sh">"</span><span class="s">body</span><span class="sh">"</span><span class="p">:</span> <span class="n">notification</span><span class="p">.</span><span class="n">body</span>
                <span class="p">},</span>
                <span class="sh">"</span><span class="s">badge</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">sound</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">default</span><span class="sh">"</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">data</span><span class="sh">"</span><span class="p">:</span> <span class="n">notification</span><span class="p">.</span><span class="n">data</span>
            <span class="p">}</span>
        <span class="p">}</span>

<span class="k">class</span> <span class="nc">AndroidNotificationService</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fcm_client</span> <span class="o">=</span> <span class="nc">FCMClient</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">retry_policy</span> <span class="o">=</span> <span class="nc">RetryPolicy</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">send</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">notification</span><span class="p">):</span>
        <span class="c1"># Format for FCM
</span>        <span class="n">fcm_payload</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_format_for_fcm</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
        
        <span class="c1"># Send with retry policy
</span>        <span class="n">response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">retry_policy</span><span class="p">.</span><span class="nf">execute</span><span class="p">(</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="n">fcm_client</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">fcm_payload</span><span class="p">)</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">status</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">delivered</span><span class="sh">"</span> <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">success</span> <span class="k">else</span> <span class="sh">"</span><span class="s">failed</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">message_id</span><span class="sh">"</span><span class="p">:</span> <span class="n">response</span><span class="p">.</span><span class="n">message_id</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="n">response</span><span class="p">.</span><span class="n">error</span>
        <span class="p">}</span>
</code></pre></div></div>
<h4 id="user-preference-management">
  
  
    <a href="#user-preference-management" class="anchor-heading" aria-labelledby="user-preference-management"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>User Preference Management</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">UserPreferenceChecker</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">preference_cache</span> <span class="o">=</span> <span class="nc">LRUCache</span><span class="p">(</span><span class="n">max_size</span><span class="o">=</span><span class="mi">1000000</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">preference_db</span> <span class="o">=</span> <span class="nc">PreferenceDatabase</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">should_send</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">notification_request</span><span class="p">):</span>
        <span class="c1"># Get user preferences
</span>        <span class="n">preferences</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_user_preferences</span><span class="p">(</span><span class="n">notification_request</span><span class="p">.</span><span class="n">user_id</span><span class="p">)</span>
        
        <span class="c1"># Check if notifications are enabled
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">preferences</span><span class="p">.</span><span class="n">platforms</span><span class="p">[</span><span class="n">notification_request</span><span class="p">.</span><span class="n">platform</span><span class="p">].</span><span class="n">enabled</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        
        <span class="c1"># Check quiet hours
</span>        <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="nf">_is_in_quiet_hours</span><span class="p">(</span><span class="n">preferences</span><span class="p">,</span> <span class="n">notification_request</span><span class="p">.</span><span class="n">platform</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        
        <span class="c1"># Check category preferences
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">preferences</span><span class="p">.</span><span class="n">categories</span><span class="p">[</span><span class="n">notification_request</span><span class="p">.</span><span class="n">category</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">False</span>
        
        <span class="c1"># Check topic subscriptions
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="nf">_is_topic_subscribed</span><span class="p">(</span><span class="n">preferences</span><span class="p">,</span> <span class="n">notification_request</span><span class="p">.</span><span class="n">topic</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">False</span>
        
        <span class="k">return</span> <span class="bp">True</span>
    
    <span class="k">def</span> <span class="nf">_get_user_preferences</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="c1"># Check cache first
</span>        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">preference_cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">preference_cache</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
        
        <span class="c1"># Get from database
</span>        <span class="n">preferences</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">preference_db</span><span class="p">.</span><span class="nf">get_preferences</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        
        <span class="c1"># Cache for future use
</span>        <span class="n">self</span><span class="p">.</span><span class="n">preference_cache</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">preferences</span>
        
        <span class="k">return</span> <span class="n">preferences</span>
</code></pre></div></div>
<h3 id="step-6-data-layer-design">
  
  
    <a href="#step-6-data-layer-design" class="anchor-heading" aria-labelledby="step-6-data-layer-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 6: Data Layer Design</strong>
  
  
</h3>
    
<h4 id="notification-storage">
  
  
    <a href="#notification-storage" class="anchor-heading" aria-labelledby="notification-storage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Notification Storage</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NotificationStorage</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">notification_db</span> <span class="o">=</span> <span class="nc">NotificationDatabase</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">template_db</span> <span class="o">=</span> <span class="nc">TemplateDatabase</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">analytics_db</span> <span class="o">=</span> <span class="nc">AnalyticsDatabase</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">store_notification</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">notification</span><span class="p">):</span>
        <span class="c1"># Store notification record
</span>        <span class="n">notification_id</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">notification_db</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
        
        <span class="c1"># Store analytics data
</span>        <span class="n">self</span><span class="p">.</span><span class="n">analytics_db</span><span class="p">.</span><span class="nf">track_notification_created</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">notification_id</span>
    
    <span class="k">def</span> <span class="nf">update_delivery_status</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">notification_id</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
        <span class="c1"># Update notification status
</span>        <span class="n">self</span><span class="p">.</span><span class="n">notification_db</span><span class="p">.</span><span class="nf">update_status</span><span class="p">(</span><span class="n">notification_id</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
        
        <span class="c1"># Track delivery analytics
</span>        <span class="n">self</span><span class="p">.</span><span class="n">analytics_db</span><span class="p">.</span><span class="nf">track_delivery_status</span><span class="p">(</span><span class="n">notification_id</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_user_notifications</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">notification_db</span><span class="p">.</span><span class="nf">get_by_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
</code></pre></div></div>
<h4 id="template-engine">
  
  
    <a href="#template-engine" class="anchor-heading" aria-labelledby="template-engine"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Template Engine</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TemplateEngine</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">template_cache</span> <span class="o">=</span> <span class="nc">LRUCache</span><span class="p">(</span><span class="n">max_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">template_db</span> <span class="o">=</span> <span class="nc">TemplateDatabase</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">template_id</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Get template from cache or database
</span>        <span class="n">template</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_template</span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span>
        
        <span class="c1"># Render template with data
</span>        <span class="n">rendered_content</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_render_template</span><span class="p">(</span><span class="n">template</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">rendered_content</span>
    
    <span class="k">def</span> <span class="nf">_get_template</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">template_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">template_id</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">template_cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">template_cache</span><span class="p">[</span><span class="n">template_id</span><span class="p">]</span>
        
        <span class="n">template</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">template_db</span><span class="p">.</span><span class="nf">get_template</span><span class="p">(</span><span class="n">template_id</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">template_cache</span><span class="p">[</span><span class="n">template_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">template</span>
        
        <span class="k">return</span> <span class="n">template</span>
    
    <span class="k">def</span> <span class="nf">_render_template</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="c1"># Simple template rendering
</span>        <span class="n">rendered</span> <span class="o">=</span> <span class="n">template</span><span class="p">.</span><span class="n">content</span>
        
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">placeholder</span> <span class="o">=</span> <span class="sh">"</span><span class="s"> + key + </span><span class="sh">"</span>
            <span class="n">rendered</span> <span class="o">=</span> <span class="n">rendered</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="n">placeholder</span><span class="p">,</span> <span class="nf">str</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">rendered</span>
</code></pre></div></div>
<h3 id="step-7-error-handling--edge-cases">
  
  
    <a href="#step-7-error-handling--edge-cases" class="anchor-heading" aria-labelledby="step-7-error-handling--edge-cases"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 7: Error Handling &amp; Edge Cases</strong>
  
  
</h3>
    
<h4 id="delivery-failure-handling">
  
  
    <a href="#delivery-failure-handling" class="anchor-heading" aria-labelledby="delivery-failure-handling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Delivery Failure Handling</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DeliveryFailureHandler</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">retry_queue</span> <span class="o">=</span> <span class="nc">RetryQueue</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">dead_letter_queue</span> <span class="o">=</span> <span class="nc">DeadLetterQueue</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">max_retries</span> <span class="o">=</span> <span class="mi">3</span>
    
    <span class="k">def</span> <span class="nf">handle_delivery_failure</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">notification</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
        <span class="c1"># Check if we should retry
</span>        <span class="k">if</span> <span class="n">notification</span><span class="p">.</span><span class="n">retry_count</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">max_retries</span><span class="p">:</span>
            <span class="c1"># Schedule retry with exponential backoff
</span>            <span class="n">retry_delay</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">notification</span><span class="p">.</span><span class="n">retry_count</span>  <span class="c1"># 1s, 2s, 4s
</span>            <span class="n">self</span><span class="p">.</span><span class="n">retry_queue</span><span class="p">.</span><span class="nf">schedule_retry</span><span class="p">(</span><span class="n">notification</span><span class="p">,</span> <span class="n">retry_delay</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Move to dead letter queue
</span>            <span class="n">self</span><span class="p">.</span><span class="n">dead_letter_queue</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">notification</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">process_retry_queue</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">notification</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">retry_queue</span><span class="p">.</span><span class="nf">get_next_retry</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">notification</span><span class="p">:</span>
                <span class="c1"># Attempt to send again
</span>                <span class="n">result</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_send_notification</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">.</span><span class="n">success</span><span class="p">:</span>
                    <span class="n">self</span><span class="p">.</span><span class="nf">handle_delivery_failure</span><span class="p">(</span><span class="n">notification</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">error</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Wait before checking again
</span></code></pre></div></div>
<h4 id="rate-limiting-and-throttling">
  
  
    <a href="#rate-limiting-and-throttling" class="anchor-heading" aria-labelledby="rate-limiting-and-throttling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Rate Limiting and Throttling</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">RateLimiter</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">limit</span><span class="p">,</span> <span class="n">window</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">limit</span> <span class="o">=</span> <span class="n">limit</span>
        <span class="n">self</span><span class="p">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">window</span>
        <span class="n">self</span><span class="p">.</span><span class="n">requests</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">def</span> <span class="nf">allow_request</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        
        <span class="c1"># Remove old requests outside the window
</span>        <span class="n">self</span><span class="p">.</span><span class="n">requests</span> <span class="o">=</span> <span class="p">[</span><span class="n">req</span> <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">requests</span> 
                        <span class="k">if</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">req</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">window</span><span class="p">]</span>
        
        <span class="c1"># Check if we're under the limit
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">requests</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">limit</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">requests</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">class</span> <span class="nc">ThrottlingManager</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_throttles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">global_throttle</span> <span class="o">=</span> <span class="nc">RateLimiter</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">should_throttle</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">notification_type</span><span class="p">):</span>
        <span class="c1"># Check global throttle
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">global_throttle</span><span class="p">.</span><span class="nf">allow_request</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">True</span>
        
        <span class="c1"># Check user-specific throttle
</span>        <span class="n">user_key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">notification_type</span><span class="si">}</span><span class="sh">"</span>
        <span class="k">if</span> <span class="n">user_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">user_throttles</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">user_throttles</span><span class="p">[</span><span class="n">user_key</span><span class="p">]</span> <span class="o">=</span> <span class="nc">RateLimiter</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">user_throttles</span><span class="p">[</span><span class="n">user_key</span><span class="p">].</span><span class="nf">allow_request</span><span class="p">()</span>
</code></pre></div></div>
<h3 id="step-8-deployment--monitoring">
  
  
    <a href="#step-8-deployment--monitoring" class="anchor-heading" aria-labelledby="step-8-deployment--monitoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 8: Deployment &amp; Monitoring</strong>
  
  
</h3>
    
<h4 id="deployment-architecture">
  
  
    <a href="#deployment-architecture" class="anchor-heading" aria-labelledby="deployment-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Deployment Architecture</strong>
  
  
</h4>
    
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Kubernetes Deployment</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">notification-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">10</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">notification-service</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">notification-service</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">notification-service</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">notification-service:latest</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">REDIS_URL</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">redis://redis:6379"</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">DATABASE_URL</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">postgresql://user:pass@db:5432/notifications"</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">requests</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1Gi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">500m"</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2Gi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1000m"</span>
</code></pre></div></div>
<h4 id="monitoring--observability">
  
  
    <a href="#monitoring--observability" class="anchor-heading" aria-labelledby="monitoring--observability"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Monitoring &amp; Observability</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NotificationMonitoring</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">notifications_sent</span><span class="sh">'</span><span class="p">:</span> <span class="nc">Counter</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">delivery_success_rate</span><span class="sh">'</span><span class="p">:</span> <span class="nc">Gauge</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">delivery_latency</span><span class="sh">'</span><span class="p">:</span> <span class="nc">Histogram</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">platform_errors</span><span class="sh">'</span><span class="p">:</span> <span class="nc">Counter</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">user_engagement</span><span class="sh">'</span><span class="p">:</span> <span class="nc">Counter</span><span class="p">()</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">track_notification_sent</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">,</span> <span class="n">notification_type</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">notifications_sent</span><span class="sh">'</span><span class="p">].</span><span class="nf">inc</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">track_delivery_result</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">,</span> <span class="n">success</span><span class="p">,</span> <span class="n">latency</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">delivery_success_rate</span><span class="sh">'</span><span class="p">].</span><span class="nf">set</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">delivery_success_rate</span><span class="sh">'</span><span class="p">].</span><span class="nf">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">delivery_latency</span><span class="sh">'</span><span class="p">].</span><span class="nf">observe</span><span class="p">(</span><span class="n">latency</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">track_platform_error</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">platform</span><span class="p">,</span> <span class="n">error_type</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">platform_errors</span><span class="sh">'</span><span class="p">].</span><span class="nf">inc</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">track_user_engagement</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">user_engagement</span><span class="sh">'</span><span class="p">].</span><span class="nf">inc</span><span class="p">()</span>
</code></pre></div></div>
<h2 id="-summary">
  
  
    <a href="#-summary" class="anchor-heading" aria-labelledby="-summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 📊 <strong>Summary</strong>
  
  
</h2>
    
<h3 id="building-blocks-used">
  
  
    <a href="#building-blocks-used" class="anchor-heading" aria-labelledby="building-blocks-used"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Building Blocks Used</strong>
  
  
</h3>
    
<ol>
  <li><strong>Data Storage</strong>: Notification history, user preferences, templates</li>
  <li><strong>Compute &amp; Processing</strong>: Template rendering, notification processing</li>
  <li><strong>Message Queuing &amp; Streaming</strong>: Notification queues, retry mechanisms</li>
  <li><strong>Networking &amp; Communication</strong>: Platform-specific APIs (APNS, FCM)</li>
  <li><strong>Caching &amp; Performance</strong>: User preference caching, template caching</li>
  <li><strong>Monitoring &amp; Observability</strong>: Delivery tracking, analytics</li>
</ol>
<h3 id="key-trade-offs">
  
  
    <a href="#key-trade-offs" class="anchor-heading" aria-labelledby="key-trade-offs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Key Trade-offs</strong>
  
  
</h3>
    
<ul>
  <li><strong>Reliability vs Latency</strong>: Higher reliability requires more retries and delays</li>
  <li><strong>Personalization vs Performance</strong>: More personalization requires more data processing</li>
  <li><strong>Platform Support vs Complexity</strong>: Supporting more platforms increases system complexity</li>
  <li><strong>Analytics vs Privacy</strong>: More detailed analytics may impact user privacy</li>
</ul>
<h3 id="scalability-considerations">
  
  
    <a href="#scalability-considerations" class="anchor-heading" aria-labelledby="scalability-considerations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Scalability Considerations</strong>
  
  
</h3>
    
<ul>
  <li><strong>Horizontal Scaling</strong>: Add more notification processing nodes</li>
  <li><strong>Geographic Distribution</strong>: Place services closer to users for lower latency</li>
  <li><strong>Platform-Specific Optimization</strong>: Optimize for each platform’s requirements</li>
  <li><strong>Queue Management</strong>: Use message queues for reliable delivery</li>
</ul>

<p>This design provides a robust, scalable notification system that can handle millions of notifications per second while maintaining high delivery success rates and respecting user preferences.</p>

          

          
        </main>
        


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
</body>
</html>

