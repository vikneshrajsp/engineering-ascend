

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/engineering-ascend/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/engineering-ascend/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  
.site-nav ul li a {
  background-image: none;
}

  </style>

  

  
    <script src="/engineering-ascend/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/engineering-ascend/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Search Autocomplete Design - System Design Challenge | Engineering Ascend</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Search Autocomplete Design - System Design Challenge" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Comprehensive solution for search autocomplete design system design challenge" />
<meta property="og:description" content="Comprehensive solution for search autocomplete design system design challenge" />
<link rel="canonical" href="http://0.0.0.0:4006/engineering-ascend/system-design-challenges/search-autocomplete-design/" />
<meta property="og:url" content="http://0.0.0.0:4006/engineering-ascend/system-design-challenges/search-autocomplete-design/" />
<meta property="og:site_name" content="Engineering Ascend" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Search Autocomplete Design - System Design Challenge" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"Comprehensive solution for search autocomplete design system design challenge","headline":"Search Autocomplete Design - System Design Challenge","url":"http://0.0.0.0:4006/engineering-ascend/system-design-challenges/search-autocomplete-design/"}</script>
<!-- End Jekyll SEO tag -->


  

</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/engineering-ascend/" class="site-title lh-tight">
  Engineering Ascend

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><a href="/engineering-ascend/back-of-envelope-estimation/" class="nav-list-link">Back-of-the-Envelope Cost Estimation</a></li><li class="nav-list-item"><a href="/engineering-ascend/building-blocks/" class="nav-list-link">Building Blocks</a></li><li class="nav-list-item"><a href="/engineering-ascend/" class="nav-list-link">Engineering Ascend</a></li><li class="nav-list-item"><a href="/engineering-ascend/quantitative-metrics/" class="nav-list-link">Quantitative Metrics for System Design</a></li><li class="nav-list-item"><a href="/engineering-ascend/cheatsheet/" class="nav-list-link">System Design - Quick Reference</a></li><li class="nav-list-item"><a href="/engineering-ascend/system-design-challenges/" class="nav-list-link">System Design Challenges</a></li><li class="nav-list-item"><a href="/engineering-ascend/decision-framework/" class="nav-list-link">System Design Decision Framework</a></li><li class="nav-list-item"><a href="/engineering-ascend/context/" class="nav-list-link">System Design Fundamentals - Comprehensive Guide</a></li><li class="nav-list-item"><a href="/engineering-ascend/trade-off-analysis/" class="nav-list-link">Trade-off Analysis in System Design</a></li></ul>

  
</nav>


  
  
    <footer class="site-footer">
      This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>
  
</div>

  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Engineering Ascend" aria-label="Search Engineering Ascend" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
</div>

    <div class="main-content-wrap">
      <nav aria-label="Breadcrumb" class="breadcrumb-nav">
  <ol class="breadcrumb-nav-list">
  
    <li class="breadcrumb-nav-list-item"><a href="">System Design Challenges</a></li>
    <li class="breadcrumb-nav-list-item"><a href="">Search Autocomplete Design</a></li>
  <li class="breadcrumb-nav-list-item"><span>Search Autocomplete Design - System Design Challenge</span></li>
  </ol>
</nav>
      <div id="main-content" class="main-content">
        <main>
          
            <h1 id="design-a-search-autocomplete-system---system-design-challenge">
  
  
    <a href="#design-a-search-autocomplete-system---system-design-challenge" class="anchor-heading" aria-labelledby="design-a-search-autocomplete-system---system-design-challenge"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Design a Search Autocomplete System - System Design Challenge
  
  
</h1>
    

<p><em>Comprehensive solution for designing a search autocomplete system, covering real-time suggestions, ranking algorithms, and global scale.</em></p>
<h2 id="-challenge-overview">
  
  
    <a href="#-challenge-overview" class="anchor-heading" aria-labelledby="-challenge-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ¯ <strong>Challenge Overview</strong>
  
  
</h2>
    

<p>Design a search autocomplete system that provides real-time suggestions as users type, with intelligent ranking and personalization for millions of users.</p>
<h3 id="key-requirements">
  
  
    <a href="#key-requirements" class="anchor-heading" aria-labelledby="key-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Key Requirements</strong>
  
  
</h3>
    
<ul>
  <li><strong>Scale</strong>: 100M+ daily searches, 10K+ suggestions/second</li>
  <li><strong>Latency</strong>: &lt;100ms response time for suggestions</li>
  <li><strong>Relevance</strong>: High-quality, personalized suggestions</li>
  <li><strong>Real-time</strong>: Suggestions update as user types</li>
  <li><strong>Multi-language</strong>: Support for multiple languages</li>
</ul>
<h2 id="ï¸-reshaded-framework-solution">
  
  
    <a href="#ï¸-reshaded-framework-solution" class="anchor-heading" aria-labelledby="ï¸-reshaded-framework-solution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ—ï¸ <strong>RESHADED Framework Solution</strong>
  
  
</h2>
    
<h3 id="step-1-requirements--constraints">
  
  
    <a href="#step-1-requirements--constraints" class="anchor-heading" aria-labelledby="step-1-requirements--constraints"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 1: Requirements &amp; Constraints</strong>
  
  
</h3>
    
<h4 id="functional-requirements">
  
  
    <a href="#functional-requirements" class="anchor-heading" aria-labelledby="functional-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Functional Requirements</strong>
  
  
</h4>
    
<ul>
  <li><strong>Real-time Suggestions</strong>: Show suggestions as user types</li>
  <li><strong>Query Completion</strong>: Complete partial queries</li>
  <li><strong>Popular Queries</strong>: Show trending and popular searches</li>
  <li><strong>Personalization</strong>: User-specific suggestions based on history</li>
  <li><strong>Multi-language</strong>: Support for different languages and locales</li>
</ul>
<h4 id="non-functional-requirements">
  
  
    <a href="#non-functional-requirements" class="anchor-heading" aria-labelledby="non-functional-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Non-Functional Requirements</strong>
  
  
</h4>
    
<ul>
  <li><strong>Scalability</strong>: Handle millions of search queries per day</li>
  <li><strong>Performance</strong>: Low latency response times</li>
  <li><strong>Availability</strong>: High availability across regions</li>
  <li><strong>Accuracy</strong>: Relevant and useful suggestions</li>
  <li><strong>Freshness</strong>: Real-time updates for trending queries</li>
</ul>
<h4 id="constraints">
  
  
    <a href="#constraints" class="anchor-heading" aria-labelledby="constraints"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Constraints</strong>
  
  
</h4>
    
<ul>
  <li><strong>Network Latency</strong>: Minimize round-trip time for suggestions</li>
  <li><strong>Storage</strong>: Efficient storage of query data and indexes</li>
  <li><strong>Memory</strong>: Fast access to frequently used data</li>
  <li><strong>Cost</strong>: Minimize infrastructure costs</li>
</ul>
<h3 id="step-2-estimation--scale">
  
  
    <a href="#step-2-estimation--scale" class="anchor-heading" aria-labelledby="step-2-estimation--scale"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 2: Estimation &amp; Scale</strong>
  
  
</h3>
    
<h4 id="capacity-planning">
  
  
    <a href="#capacity-planning" class="anchor-heading" aria-labelledby="capacity-planning"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Capacity Planning</strong>
  
  
</h4>
    
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Daily Active Users: 50M
Searches per User: 10/day average
Total Daily Searches: 50M Ã— 10 = 500M/day
Peak Hour Searches: 500M Ã— 0.15 = 75M/hour
Peak Minute Searches: 75M Ã· 60 = 1.25M/minute
Peak Second Searches: 1.25M Ã· 60 = 21K/second

Suggestions per Search: 10 suggestions average
Peak Suggestions: 21K Ã— 10 = 210K/second

Storage Requirements:
- Query History: 500M Ã— 100 bytes = 50GB/day
- User Preferences: 50M Ã— 2KB = 100GB
- Query Indexes: 1M unique queries Ã— 1KB = 1GB
- Trending Data: 10K trending queries Ã— 1KB = 10MB
</code></pre></div></div>
<h4 id="peak-load-estimation">
  
  
    <a href="#peak-load-estimation" class="anchor-heading" aria-labelledby="peak-load-estimation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Peak Load Estimation</strong>
  
  
</h4>
    
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Peak Factor: 3x normal load
Peak Searches: 63K/second
Peak Suggestions: 630K/second

Geographic Distribution:
- North America: 40%
- Europe: 30%
- Asia: 20%
- Others: 10%

Query Length Distribution:
- 1-3 characters: 20%
- 4-6 characters: 40%
- 7-10 characters: 30%
- 10+ characters: 10%
</code></pre></div></div>
<h3 id="step-3-system-interface-design">
  
  
    <a href="#step-3-system-interface-design" class="anchor-heading" aria-labelledby="step-3-system-interface-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 3: System Interface Design</strong>
  
  
</h3>
    
<h4 id="api-design">
  
  
    <a href="#api-design" class="anchor-heading" aria-labelledby="api-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>API Design</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Core Operations
</span><span class="nf">get_suggestions</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">suggestion</span><span class="p">]</span>
<span class="nf">get_trending_queries</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">query</span><span class="p">]</span>
<span class="nf">get_personalized_suggestions</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">suggestion</span><span class="p">]</span>

<span class="c1"># User Management
</span><span class="nf">update_user_preferences</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">preferences</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">success</span>
<span class="nf">get_user_search_history</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="n">query</span><span class="p">]</span>
<span class="nf">clear_user_history</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">success</span>

<span class="c1"># Analytics
</span><span class="nf">track_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">selected_suggestion</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">success</span>
<span class="nf">get_query_analytics</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">time_range</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">analytics</span>
</code></pre></div></div>
<h4 id="data-models">
  
  
    <a href="#data-models" class="anchor-heading" aria-labelledby="data-models"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Data Models</strong>
  
  
</h4>
    
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"suggestion"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"machine learning"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"score"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.95</span><span class="p">,</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"completion"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"frequency"</span><span class="p">:</span><span class="w"> </span><span class="mi">15000</span><span class="p">,</span><span class="w">
      </span><span class="nl">"click_rate"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.12</span><span class="p">,</span><span class="w">
      </span><span class="nl">"conversion_rate"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.08</span><span class="p">,</span><span class="w">
      </span><span class="nl">"last_updated"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-01T12:00:00Z"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"user_preferences"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"user_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user_123"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"en"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"region"</span><span class="p">:</span><span class="w"> </span><span class="s2">"US"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"interests"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"technology"</span><span class="p">,</span><span class="w"> </span><span class="s2">"science"</span><span class="p">],</span><span class="w">
    </span><span class="nl">"search_history"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"python tutorial"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2024-01-01T10:00:00Z"</span><span class="p">,</span><span class="w">
        </span><span class="nl">"selected_suggestion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"python tutorial for beginners"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nl">"trending_query"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"query"</span><span class="p">:</span><span class="w"> </span><span class="s2">"artificial intelligence"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"trend_score"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.98</span><span class="p">,</span><span class="w">
    </span><span class="nl">"category"</span><span class="p">:</span><span class="w"> </span><span class="s2">"technology"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"growth_rate"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.25</span><span class="p">,</span><span class="w">
    </span><span class="nl">"geographic_distribution"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nl">"US"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.4</span><span class="p">,</span><span class="w">
      </span><span class="nl">"EU"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.3</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Asia"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.2</span><span class="p">,</span><span class="w">
      </span><span class="nl">"Others"</span><span class="p">:</span><span class="w"> </span><span class="mf">0.1</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<h3 id="step-4-high-level-architecture">
  
  
    <a href="#step-4-high-level-architecture" class="anchor-heading" aria-labelledby="step-4-high-level-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 4: High-Level Architecture</strong>
  
  
</h3>
    

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Client Applications                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Load Balancer                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              API Gateway / Autocomplete Service         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Suggestion Processing Pipeline              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Query     â”‚  â”‚  Trending   â”‚  â”‚Personalized â”‚     â”‚
â”‚  â”‚ Completion  â”‚  â”‚  Queries    â”‚  â”‚ Suggestions â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Ranking &amp; Scoring Engine                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Cache Layer (Redis)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Search Index (Elasticsearch)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              Analytics &amp; Learning Pipeline              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div></div>
<h3 id="step-5-application-layer-design">
  
  
    <a href="#step-5-application-layer-design" class="anchor-heading" aria-labelledby="step-5-application-layer-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 5: Application Layer Design</strong>
  
  
</h3>
    
<h4 id="suggestion-processing-pipeline">
  
  
    <a href="#suggestion-processing-pipeline" class="anchor-heading" aria-labelledby="suggestion-processing-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Suggestion Processing Pipeline</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AutocompletePipeline</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">query_completer</span> <span class="o">=</span> <span class="nc">QueryCompleter</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">trending_service</span> <span class="o">=</span> <span class="nc">TrendingService</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">personalization_service</span> <span class="o">=</span> <span class="nc">PersonalizationService</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">ranking_engine</span> <span class="o">=</span> <span class="nc">RankingEngine</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cache_service</span> <span class="o">=</span> <span class="nc">CacheService</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="c1"># 1. Check cache first
</span>        <span class="n">cache_key</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">suggestions:</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">cached_suggestions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">cache_service</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">cache_key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached_suggestions</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cached_suggestions</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
        
        <span class="c1"># 2. Get query completions
</span>        <span class="n">completions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">query_completer</span><span class="p">.</span><span class="nf">get_completions</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        
        <span class="c1"># 3. Get trending queries
</span>        <span class="n">trending</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">trending_service</span><span class="p">.</span><span class="nf">get_trending_queries</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        
        <span class="c1"># 4. Get personalized suggestions
</span>        <span class="n">personalized</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="n">personalized</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">personalization_service</span><span class="p">.</span><span class="nf">get_suggestions</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        
        <span class="c1"># 5. Combine and rank suggestions
</span>        <span class="n">all_suggestions</span> <span class="o">=</span> <span class="n">completions</span> <span class="o">+</span> <span class="n">trending</span> <span class="o">+</span> <span class="n">personalized</span>
        <span class="n">ranked_suggestions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">ranking_engine</span><span class="p">.</span><span class="nf">rank_suggestions</span><span class="p">(</span>
            <span class="n">all_suggestions</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">user_id</span>
        <span class="p">)</span>
        
        <span class="c1"># 6. Cache results
</span>        <span class="n">self</span><span class="p">.</span><span class="n">cache_service</span><span class="p">.</span><span class="nf">set</span><span class="p">(</span><span class="n">cache_key</span><span class="p">,</span> <span class="n">ranked_suggestions</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
        
        <span class="c1"># 7. Track analytics
</span>        <span class="n">self</span><span class="p">.</span><span class="nf">_track_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">ranked_suggestions</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
</code></pre></div></div>
<h4 id="query-completion-engine">
  
  
    <a href="#query-completion-engine" class="anchor-heading" aria-labelledby="query-completion-engine"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Query Completion Engine</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">QueryCompleter</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">trie</span> <span class="o">=</span> <span class="nc">Trie</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">query_index</span> <span class="o">=</span> <span class="nc">QueryIndex</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">get_completions</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="c1"># Get completions from trie
</span>        <span class="n">trie_completions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">trie</span><span class="p">.</span><span class="nf">get_completions</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        
        <span class="c1"># Get completions from search index
</span>        <span class="n">index_completions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">query_index</span><span class="p">.</span><span class="nf">search_prefix</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        
        <span class="c1"># Combine and deduplicate
</span>        <span class="n">all_completions</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">set</span><span class="p">(</span><span class="n">trie_completions</span> <span class="o">+</span> <span class="n">index_completions</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">all_completions</span>
    
    <span class="k">def</span> <span class="nf">update_trie</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">new_queries</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">new_queries</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">trie</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_popular_completions</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="n">completions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_completions</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        
        <span class="c1"># Sort by popularity
</span>        <span class="n">sorted_completions</span> <span class="o">=</span> <span class="nf">sorted</span><span class="p">(</span>
            <span class="n">completions</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">metadata</span><span class="p">.</span><span class="n">frequency</span><span class="p">,</span>
            <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">sorted_completions</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">Trie</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">root</span> <span class="o">=</span> <span class="nc">TrieNode</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">word</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">word</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="p">.</span><span class="n">children</span><span class="p">:</span>
                <span class="n">node</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="n">char</span><span class="p">]</span> <span class="o">=</span> <span class="nc">TrieNode</span><span class="p">()</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
        <span class="n">node</span><span class="p">.</span><span class="n">is_end</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">node</span><span class="p">.</span><span class="n">word</span> <span class="o">=</span> <span class="n">word</span>
    
    <span class="k">def</span> <span class="nf">get_completions</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">root</span>
        <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">prefix</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">char</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">node</span><span class="p">.</span><span class="n">children</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">node</span><span class="p">.</span><span class="n">children</span><span class="p">[</span><span class="n">char</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_all_words</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">prefix</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_get_all_words</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
        <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">node</span><span class="p">.</span><span class="n">is_end</span><span class="p">:</span>
            <span class="n">words</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">char</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="p">.</span><span class="n">children</span><span class="p">.</span><span class="nf">items</span><span class="p">():</span>
            <span class="n">words</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="nf">_get_all_words</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">+</span> <span class="n">char</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">words</span>
</code></pre></div></div>
<h4 id="trending-queries-service">
  
  
    <a href="#trending-queries-service" class="anchor-heading" aria-labelledby="trending-queries-service"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Trending Queries Service</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TrendingService</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">trending_cache</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">trending_analyzer</span> <span class="o">=</span> <span class="nc">TrendingAnalyzer</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">update_interval</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># 5 minutes
</span>    
    <span class="k">def</span> <span class="nf">get_trending_queries</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="c1"># Get trending queries from cache
</span>        <span class="n">trending_queries</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_cached_trending</span><span class="p">()</span>
        
        <span class="c1"># Filter by query if provided
</span>        <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
            <span class="n">trending_queries</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_filter_by_query</span><span class="p">(</span><span class="n">trending_queries</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        
        <span class="c1"># Sort by trend score
</span>        <span class="n">sorted_queries</span> <span class="o">=</span> <span class="nf">sorted</span><span class="p">(</span>
            <span class="n">trending_queries</span><span class="p">,</span>
            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">trend_score</span><span class="p">,</span>
            <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">sorted_queries</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">update_trending_queries</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="c1"># Analyze recent queries for trends
</span>        <span class="n">recent_queries</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_recent_queries</span><span class="p">()</span>
        <span class="n">trending_queries</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">trending_analyzer</span><span class="p">.</span><span class="nf">analyze_trends</span><span class="p">(</span><span class="n">recent_queries</span><span class="p">)</span>
        
        <span class="c1"># Update cache
</span>        <span class="n">self</span><span class="p">.</span><span class="n">trending_cache</span> <span class="o">=</span> <span class="n">trending_queries</span>
    
    <span class="k">def</span> <span class="nf">_get_cached_trending</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">self</span><span class="p">.</span><span class="n">trending_cache</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="nf">update_trending_queries</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">trending_cache</span>

<span class="k">class</span> <span class="nc">TrendingAnalyzer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">time_windows</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">]</span>  <span class="c1"># hours
</span>    
    <span class="k">def</span> <span class="nf">analyze_trends</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">queries</span><span class="p">):</span>
        <span class="n">trending_queries</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">:</span>
            <span class="n">trend_score</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_trend_score</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">trend_score</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>  <span class="c1"># Threshold for trending
</span>                <span class="n">trending_queries</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                    <span class="sh">'</span><span class="s">query</span><span class="sh">'</span><span class="p">:</span> <span class="n">query</span><span class="p">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">trend_score</span><span class="sh">'</span><span class="p">:</span> <span class="n">trend_score</span><span class="p">,</span>
                    <span class="sh">'</span><span class="s">growth_rate</span><span class="sh">'</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_growth_rate</span><span class="p">(</span><span class="n">query</span><span class="p">),</span>
                    <span class="sh">'</span><span class="s">category</span><span class="sh">'</span><span class="p">:</span> <span class="n">query</span><span class="p">.</span><span class="n">category</span>
                <span class="p">})</span>
        
        <span class="k">return</span> <span class="n">trending_queries</span>
    
    <span class="k">def</span> <span class="nf">_calculate_trend_score</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="c1"># Calculate trend score based on frequency increase
</span>        <span class="n">current_freq</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">get_frequency</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Last hour
</span>        <span class="n">previous_freq</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">get_frequency</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>  <span class="c1"># Last 6 hours
</span>        
        <span class="k">if</span> <span class="n">previous_freq</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        
        <span class="n">growth_rate</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_freq</span> <span class="o">-</span> <span class="n">previous_freq</span><span class="p">)</span> <span class="o">/</span> <span class="n">previous_freq</span>
        <span class="k">return</span> <span class="nf">min</span><span class="p">(</span><span class="n">growth_rate</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># Cap at 1.0
</span></code></pre></div></div>
<h4 id="personalization-service">
  
  
    <a href="#personalization-service" class="anchor-heading" aria-labelledby="personalization-service"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Personalization Service</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PersonalizationService</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">user_profiles</span> <span class="o">=</span> <span class="nc">UserProfileManager</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">collaborative_filter</span> <span class="o">=</span> <span class="nc">CollaborativeFilter</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">ml_model</span> <span class="o">=</span> <span class="nc">MLModel</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="c1"># Get user profile
</span>        <span class="n">user_profile</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">user_profiles</span><span class="p">.</span><span class="nf">get_profile</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        
        <span class="c1"># Get collaborative filtering suggestions
</span>        <span class="n">cf_suggestions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">collaborative_filter</span><span class="p">.</span><span class="nf">get_suggestions</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        
        <span class="c1"># Get ML-based suggestions
</span>        <span class="n">ml_suggestions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">ml_model</span><span class="p">.</span><span class="nf">predict_suggestions</span><span class="p">(</span><span class="n">user_profile</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        
        <span class="c1"># Combine and rank
</span>        <span class="n">all_suggestions</span> <span class="o">=</span> <span class="n">cf_suggestions</span> <span class="o">+</span> <span class="n">ml_suggestions</span>
        <span class="n">personalized_suggestions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_rank_by_personalization</span><span class="p">(</span>
            <span class="n">all_suggestions</span><span class="p">,</span> <span class="n">user_profile</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">personalized_suggestions</span><span class="p">[:</span><span class="n">limit</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">_rank_by_personalization</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">suggestions</span><span class="p">,</span> <span class="n">user_profile</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">suggestion</span> <span class="ow">in</span> <span class="n">suggestions</span><span class="p">:</span>
            <span class="c1"># Calculate personalization score
</span>            <span class="n">personalization_score</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_personalization_score</span><span class="p">(</span>
                <span class="n">suggestion</span><span class="p">,</span> <span class="n">user_profile</span>
            <span class="p">)</span>
            <span class="n">suggestion</span><span class="p">.</span><span class="n">personalization_score</span> <span class="o">=</span> <span class="n">personalization_score</span>
        
        <span class="c1"># Sort by personalization score
</span>        <span class="k">return</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">suggestions</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">.</span><span class="n">personalization_score</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_calculate_personalization_score</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">suggestion</span><span class="p">,</span> <span class="n">user_profile</span><span class="p">):</span>
        <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
        
        <span class="c1"># Interest matching
</span>        <span class="k">if</span> <span class="n">suggestion</span><span class="p">.</span><span class="n">category</span> <span class="ow">in</span> <span class="n">user_profile</span><span class="p">.</span><span class="n">interests</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mf">0.3</span>
        
        <span class="c1"># Historical preference
</span>        <span class="k">if</span> <span class="n">suggestion</span><span class="p">.</span><span class="n">query</span> <span class="ow">in</span> <span class="n">user_profile</span><span class="p">.</span><span class="n">search_history</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mf">0.2</span>
        
        <span class="c1"># Similar user behavior
</span>        <span class="k">if</span> <span class="n">suggestion</span><span class="p">.</span><span class="n">query</span> <span class="ow">in</span> <span class="n">user_profile</span><span class="p">.</span><span class="n">similar_users_queries</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mf">0.2</span>
        
        <span class="c1"># Recency
</span>        <span class="k">if</span> <span class="n">suggestion</span><span class="p">.</span><span class="n">is_recent</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="mf">0.1</span>
        
        <span class="k">return</span> <span class="nf">min</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</code></pre></div></div>
<h3 id="step-6-data-layer-design">
  
  
    <a href="#step-6-data-layer-design" class="anchor-heading" aria-labelledby="step-6-data-layer-design"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 6: Data Layer Design</strong>
  
  
</h3>
    
<h4 id="search-index-elasticsearch">
  
  
    <a href="#search-index-elasticsearch" class="anchor-heading" aria-labelledby="search-index-elasticsearch"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Search Index (Elasticsearch)</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">QueryIndex</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">es_client</span> <span class="o">=</span> <span class="nc">ElasticsearchClient</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">index_name</span> <span class="o">=</span> <span class="sh">"</span><span class="s">autocomplete_queries</span><span class="sh">"</span>
    
    <span class="k">def</span> <span class="nf">search_prefix</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
        <span class="c1"># Search for queries starting with prefix
</span>        <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">prefix</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="sh">"</span><span class="s">query_text</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="sh">"</span><span class="s">value</span><span class="sh">"</span><span class="p">:</span> <span class="n">prefix</span><span class="p">.</span><span class="nf">lower</span><span class="p">(),</span>
                        <span class="sh">"</span><span class="s">boost</span><span class="sh">"</span><span class="p">:</span> <span class="mf">1.0</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="sh">"</span><span class="s">sort</span><span class="sh">"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span><span class="sh">"</span><span class="s">frequency</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">order</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">desc</span><span class="sh">"</span><span class="p">}},</span>
                <span class="p">{</span><span class="sh">"</span><span class="s">click_rate</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">order</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">desc</span><span class="sh">"</span><span class="p">}}</span>
            <span class="p">],</span>
            <span class="sh">"</span><span class="s">size</span><span class="sh">"</span><span class="p">:</span> <span class="n">limit</span>
        <span class="p">}</span>
        
        <span class="n">response</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">es_client</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">index_name</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">[</span><span class="n">self</span><span class="p">.</span><span class="nf">_parse_hit</span><span class="p">(</span><span class="n">hit</span><span class="p">)</span> <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">response</span><span class="p">[</span><span class="sh">'</span><span class="s">hits</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">hits</span><span class="sh">'</span><span class="p">]]</span>
    
    <span class="k">def</span> <span class="nf">index_query</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query_data</span><span class="p">):</span>
        <span class="c1"># Index new query data
</span>        <span class="n">document</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">query_text</span><span class="sh">"</span><span class="p">:</span> <span class="n">query_data</span><span class="p">.</span><span class="n">query</span><span class="p">.</span><span class="nf">lower</span><span class="p">(),</span>
            <span class="sh">"</span><span class="s">frequency</span><span class="sh">"</span><span class="p">:</span> <span class="n">query_data</span><span class="p">.</span><span class="n">frequency</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">click_rate</span><span class="sh">"</span><span class="p">:</span> <span class="n">query_data</span><span class="p">.</span><span class="n">click_rate</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">conversion_rate</span><span class="sh">"</span><span class="p">:</span> <span class="n">query_data</span><span class="p">.</span><span class="n">conversion_rate</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">category</span><span class="sh">"</span><span class="p">:</span> <span class="n">query_data</span><span class="p">.</span><span class="n">category</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">last_updated</span><span class="sh">"</span><span class="p">:</span> <span class="n">query_data</span><span class="p">.</span><span class="n">timestamp</span>
        <span class="p">}</span>
        
        <span class="n">self</span><span class="p">.</span><span class="n">es_client</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">index_name</span><span class="p">,</span> <span class="n">document</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_parse_hit</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">hit</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">query</span><span class="sh">"</span><span class="p">:</span> <span class="n">hit</span><span class="p">[</span><span class="sh">"</span><span class="s">_source</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">query_text</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">score</span><span class="sh">"</span><span class="p">:</span> <span class="n">hit</span><span class="p">[</span><span class="sh">"</span><span class="s">_score</span><span class="sh">"</span><span class="p">],</span>
            <span class="sh">"</span><span class="s">metadata</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span>
                <span class="sh">"</span><span class="s">frequency</span><span class="sh">"</span><span class="p">:</span> <span class="n">hit</span><span class="p">[</span><span class="sh">"</span><span class="s">_source</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">frequency</span><span class="sh">"</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">click_rate</span><span class="sh">"</span><span class="p">:</span> <span class="n">hit</span><span class="p">[</span><span class="sh">"</span><span class="s">_source</span><span class="sh">"</span><span class="p">][</span><span class="sh">"</span><span class="s">click_rate</span><span class="sh">"</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre></div></div>
<h4 id="cache-layer-redis">
  
  
    <a href="#cache-layer-redis" class="anchor-heading" aria-labelledby="cache-layer-redis"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Cache Layer (Redis)</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CacheService</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">redis_client</span> <span class="o">=</span> <span class="nc">RedisClient</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">default_ttl</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># 5 minutes
</span>    
    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">redis_client</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">if</span> <span class="n">value</span> <span class="k">else</span> <span class="bp">None</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
    
    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ttl</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ttl</span> <span class="o">=</span> <span class="n">ttl</span> <span class="ow">or</span> <span class="n">self</span><span class="p">.</span><span class="n">default_ttl</span>
            <span class="n">serialized_value</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">self</span><span class="p">.</span><span class="n">redis_client</span><span class="p">.</span><span class="nf">setex</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">ttl</span><span class="p">,</span> <span class="n">serialized_value</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">def</span> <span class="nf">get_suggestions_cache_key</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="c1"># Create cache key for suggestions
</span>        <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="s">suggestions:</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="sh">"</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="sh">"</span><span class="s">suggestions:</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s">:anonymous</span><span class="sh">"</span>
    
    <span class="k">def</span> <span class="nf">invalidate_user_cache</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="c1"># Invalidate all cached suggestions for a user
</span>        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">suggestions:*:</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="sh">"</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">redis_client</span><span class="p">.</span><span class="nf">keys</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">keys</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">redis_client</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="o">*</span><span class="n">keys</span><span class="p">)</span>
</code></pre></div></div>
<h3 id="step-7-error-handling--edge-cases">
  
  
    <a href="#step-7-error-handling--edge-cases" class="anchor-heading" aria-labelledby="step-7-error-handling--edge-cases"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 7: Error Handling &amp; Edge Cases</strong>
  
  
</h3>
    
<h4 id="query-processing-errors">
  
  
    <a href="#query-processing-errors" class="anchor-heading" aria-labelledby="query-processing-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Query Processing Errors</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">QueryErrorHandler</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">fallback_service</span> <span class="o">=</span> <span class="nc">FallbackService</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">error_tracker</span> <span class="o">=</span> <span class="nc">ErrorTracker</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">handle_query_error</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">error</span><span class="p">):</span>
        <span class="c1"># Log error
</span>        <span class="n">self</span><span class="p">.</span><span class="n">error_tracker</span><span class="p">.</span><span class="nf">track_error</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
        
        <span class="c1"># Return fallback suggestions
</span>        <span class="n">fallback_suggestions</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">fallback_service</span><span class="p">.</span><span class="nf">get_suggestions</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">suggestions</span><span class="sh">"</span><span class="p">:</span> <span class="n">fallback_suggestions</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">error</span><span class="p">),</span>
            <span class="sh">"</span><span class="s">fallback_used</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">handle_empty_results</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="c1"># Return popular queries when no suggestions found
</span>        <span class="n">popular_queries</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">fallback_service</span><span class="p">.</span><span class="nf">get_popular_queries</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="p">{</span>
            <span class="sh">"</span><span class="s">suggestions</span><span class="sh">"</span><span class="p">:</span> <span class="n">popular_queries</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">message</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">No specific suggestions found</span><span class="sh">"</span><span class="p">,</span>
            <span class="sh">"</span><span class="s">fallback_used</span><span class="sh">"</span><span class="p">:</span> <span class="bp">True</span>
        <span class="p">}</span>

<span class="k">class</span> <span class="nc">FallbackService</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">popular_queries</span> <span class="o">=</span> <span class="p">[</span>
            <span class="sh">"</span><span class="s">how to</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">what is</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">best</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">top</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">guide</span><span class="sh">"</span>
        <span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">get_suggestions</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="c1"># Return generic suggestions based on query
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">get_popular_queries</span><span class="p">()</span>
        
        <span class="c1"># Return query with common suffixes
</span>        <span class="n">suffixes</span> <span class="o">=</span> <span class="p">[</span><span class="sh">"</span><span class="s"> tutorial</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s"> guide</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s"> examples</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s"> tips</span><span class="sh">"</span><span class="p">]</span>
        <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[</span><span class="n">query</span> <span class="o">+</span> <span class="n">suffix</span> <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="n">suffixes</span><span class="p">]</span>
        
        <span class="k">return</span> <span class="n">suggestions</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
    
    <span class="k">def</span> <span class="nf">get_popular_queries</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="n">popular_queries</span>
</code></pre></div></div>
<h4 id="performance-optimization">
  
  
    <a href="#performance-optimization" class="anchor-heading" aria-labelledby="performance-optimization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Performance Optimization</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">PerformanceOptimizer</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">query_length_threshold</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cache_hit_threshold</span> <span class="o">=</span> <span class="mf">0.8</span>
    
    <span class="k">def</span> <span class="nf">should_process_query</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query</span><span class="p">):</span>
        <span class="c1"># Skip very short queries
</span>        <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">strip</span><span class="p">())</span> <span class="o">&lt;</span> <span class="n">self</span><span class="p">.</span><span class="n">query_length_threshold</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        
        <span class="k">return</span> <span class="bp">True</span>
    
    <span class="k">def</span> <span class="nf">optimize_suggestions</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">suggestions</span><span class="p">,</span> <span class="n">query_length</span><span class="p">):</span>
        <span class="c1"># Adjust number of suggestions based on query length
</span>        <span class="k">if</span> <span class="n">query_length</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">suggestions</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># Fewer suggestions for short queries
</span>        <span class="k">elif</span> <span class="n">query_length</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">suggestions</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span>  <span class="c1"># Medium suggestions
</span>        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">suggestions</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>  <span class="c1"># More suggestions for longer queries
</span>    
    <span class="k">def</span> <span class="nf">should_cache</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
        <span class="c1"># Cache more aggressively for anonymous users
</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        
        <span class="c1"># Cache based on query frequency
</span>        <span class="n">query_frequency</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_get_query_frequency</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">query_frequency</span> <span class="o">&gt;</span> <span class="mi">100</span>  <span class="c1"># Cache popular queries
</span></code></pre></div></div>
<h3 id="step-8-deployment--monitoring">
  
  
    <a href="#step-8-deployment--monitoring" class="anchor-heading" aria-labelledby="step-8-deployment--monitoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Step 8: Deployment &amp; Monitoring</strong>
  
  
</h3>
    
<h4 id="deployment-architecture">
  
  
    <a href="#deployment-architecture" class="anchor-heading" aria-labelledby="deployment-architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Deployment Architecture</strong>
  
  
</h4>
    
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Kubernetes Deployment</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">apps/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Deployment</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">autocomplete-service</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">replicas</span><span class="pi">:</span> <span class="m">5</span>
  <span class="na">selector</span><span class="pi">:</span>
    <span class="na">matchLabels</span><span class="pi">:</span>
      <span class="na">app</span><span class="pi">:</span> <span class="s">autocomplete-service</span>
  <span class="na">template</span><span class="pi">:</span>
    <span class="na">metadata</span><span class="pi">:</span>
      <span class="na">labels</span><span class="pi">:</span>
        <span class="na">app</span><span class="pi">:</span> <span class="s">autocomplete-service</span>
    <span class="na">spec</span><span class="pi">:</span>
      <span class="na">containers</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">autocomplete-service</span>
        <span class="na">image</span><span class="pi">:</span> <span class="s">autocomplete-service:latest</span>
        <span class="na">ports</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">containerPort</span><span class="pi">:</span> <span class="m">8080</span>
        <span class="na">env</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">ELASTICSEARCH_URL</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">http://elasticsearch:9200"</span>
        <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">REDIS_URL</span>
          <span class="na">value</span><span class="pi">:</span> <span class="s2">"</span><span class="s">redis://redis:6379"</span>
        <span class="na">resources</span><span class="pi">:</span>
          <span class="na">requests</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1Gi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">500m"</span>
          <span class="na">limits</span><span class="pi">:</span>
            <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2Gi"</span>
            <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1000m"</span>
</code></pre></div></div>
<h4 id="monitoring--observability">
  
  
    <a href="#monitoring--observability" class="anchor-heading" aria-labelledby="monitoring--observability"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Monitoring &amp; Observability</strong>
  
  
</h4>
    
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AutocompleteMonitoring</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sh">'</span><span class="s">queries_per_second</span><span class="sh">'</span><span class="p">:</span> <span class="nc">Counter</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">suggestion_latency</span><span class="sh">'</span><span class="p">:</span> <span class="nc">Histogram</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">cache_hit_rate</span><span class="sh">'</span><span class="p">:</span> <span class="nc">Gauge</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">suggestion_accuracy</span><span class="sh">'</span><span class="p">:</span> <span class="nc">Gauge</span><span class="p">(),</span>
            <span class="sh">'</span><span class="s">error_rate</span><span class="sh">'</span><span class="p">:</span> <span class="nc">Counter</span><span class="p">()</span>
        <span class="p">}</span>
    
    <span class="k">def</span> <span class="nf">track_query</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">latency</span><span class="p">,</span> <span class="n">cache_hit</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">queries_per_second</span><span class="sh">'</span><span class="p">].</span><span class="nf">inc</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">suggestion_latency</span><span class="sh">'</span><span class="p">].</span><span class="nf">observe</span><span class="p">(</span><span class="n">latency</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cache_hit</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">cache_hit_rate</span><span class="sh">'</span><span class="p">].</span><span class="nf">set</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">cache_hit_rate</span><span class="sh">'</span><span class="p">].</span><span class="nf">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">track_suggestion_click</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">selected_suggestion</span><span class="p">):</span>
        <span class="c1"># Track suggestion accuracy
</span>        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">_calculate_accuracy</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">selected_suggestion</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">suggestion_accuracy</span><span class="sh">'</span><span class="p">].</span><span class="nf">set</span><span class="p">(</span><span class="n">accuracy</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">track_error</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">error_type</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="n">metrics</span><span class="p">[</span><span class="sh">'</span><span class="s">error_rate</span><span class="sh">'</span><span class="p">].</span><span class="nf">inc</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">_calculate_accuracy</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">selected_suggestion</span><span class="p">):</span>
        <span class="c1"># Simple accuracy calculation
</span>        <span class="k">if</span> <span class="n">query</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">selected_suggestion</span><span class="p">.</span><span class="nf">lower</span><span class="p">():</span>
            <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">elif</span> <span class="nf">len</span><span class="p">(</span><span class="nf">set</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">lower</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nf">set</span><span class="p">(</span><span class="n">selected_suggestion</span><span class="p">.</span><span class="nf">lower</span><span class="p">()))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.5</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
</code></pre></div></div>
<h2 id="-summary">
  
  
    <a href="#-summary" class="anchor-heading" aria-labelledby="-summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ“Š <strong>Summary</strong>
  
  
</h2>
    
<h3 id="building-blocks-used">
  
  
    <a href="#building-blocks-used" class="anchor-heading" aria-labelledby="building-blocks-used"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Building Blocks Used</strong>
  
  
</h3>
    
<ol>
  <li><strong>Data Storage</strong>: Query indexes, user profiles, search history</li>
  <li><strong>Compute &amp; Processing</strong>: Query completion, trending analysis, personalization</li>
  <li><strong>Caching &amp; Performance</strong>: Redis caching, trie data structure</li>
  <li><strong>Networking &amp; Communication</strong>: Real-time API responses</li>
  <li><strong>Monitoring &amp; Observability</strong>: Query analytics, performance metrics</li>
</ol>
<h3 id="key-trade-offs">
  
  
    <a href="#key-trade-offs" class="anchor-heading" aria-labelledby="key-trade-offs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Key Trade-offs</strong>
  
  
</h3>
    
<ul>
  <li><strong>Accuracy vs Speed</strong>: More accurate suggestions require more processing time</li>
  <li><strong>Personalization vs Privacy</strong>: More personalization requires more user data</li>
  <li><strong>Cache Size vs Memory</strong>: Larger cache improves performance but uses more memory</li>
  <li><strong>Real-time vs Freshness</strong>: Real-time updates may impact performance</li>
</ul>
<h3 id="scalability-considerations">
  
  
    <a href="#scalability-considerations" class="anchor-heading" aria-labelledby="scalability-considerations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Scalability Considerations</strong>
  
  
</h3>
    
<ul>
  <li><strong>Horizontal Scaling</strong>: Add more autocomplete service instances</li>
  <li><strong>Geographic Distribution</strong>: Place services closer to users for lower latency</li>
  <li><strong>Cache Optimization</strong>: Use distributed caching for better performance</li>
  <li><strong>Index Optimization</strong>: Optimize search indexes for faster queries</li>
</ul>

<p>This design provides a robust, scalable autocomplete system that can handle millions of queries per day while providing relevant, personalized suggestions in real-time.</p>

          

          
        </main>
        


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
</body>
</html>

